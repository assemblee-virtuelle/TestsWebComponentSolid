<template id="tmpl-login">
    <form id="loginForm">
        <label for="username">Username :</label>
        <input type="text" name="username" id="username"><br>
        <label for="password">Password :</label>
        <input type="password" name="password" id="password"><br>
        <button type="submit" id="Submit">Submit</button> 
    </form>
</template>
<script>
    const loginTmpl = document.currentScript.ownerDocument.getElementById('tmpl-login');
    class Login extends HTMLElement{
        constructor(){
            super();
            const shadowRoot = this.attachShadow({
                mode: 'open'
            });
            const instance = loginTmpl.content.cloneNode(true);
            this.shadowRoot.appendChild(instance);
            this.login = this.shadowRoot.getElementById("loginForm");
        }

        connectedCallback(){
            this.login.addEventListener('submit', e => {
                e.preventDefault();
                this.loginForm();
            })
        }

        loginForm(){
            let formData = this.shadowRoot.querySelectorAll('input');
            let res = {};
            for (let i = 0; i < formData.length; i++){
                res[formData[i].name] = formData[i].value;
            }
            if (this.postal){
                this.postal.publish({
                    channel:'auth',
                    topic:'login',
                    data:res
                });
            }
        }

        setPostal(postal){
            this.postal = postal;
        }

    }
    window.customElements.define('login-interface', Login);
</script>